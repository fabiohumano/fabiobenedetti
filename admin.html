<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | HUMANO Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0a0a0a; color: white; font-family: 'Inter', sans-serif; }
        .input-dark { background: #1a1a1a; border: 1px solid #333; padding: 12px; border-radius: 8px; width: 100%; color: white; outline: none; transition: border-color 0.3s; }
        .input-dark:focus { border-color: #666; }
        .btn-primary { background: white; color: black; font-weight: bold; padding: 12px; border-radius: 8px; transition: all 0.3s; cursor: pointer; }
        .btn-primary:hover { background: #ccc; transform: translateY(-2px); }
        .btn-primary:disabled { background: #444; color: #888; cursor: not-allowed; }
        .hidden { display: none; }
    </style>
</head>
<body class="p-6 md:p-12">

    <!-- TELA DE LOGIN -->
    <div id="login-screen" class="max-w-md mx-auto mt-20 p-8 bg-neutral-900 rounded-3xl border border-white/5">
        <h1 class="text-3xl font-bold mb-2 text-center">HUMANO <span class="text-neutral-500 italic">Admin</span></h1>
        <p class="text-center text-neutral-500 text-sm mb-8">Acesse para gerenciar seu portfﾃｳlio</p>
        <form id="login-form" class="space-y-4">
            <input type="email" id="login-email" placeholder="E-mail" class="input-dark" required>
            <input type="password" id="login-pass" placeholder="Senha" class="input-dark" required>
            <button type="submit" class="w-full btn-primary">ENTRAR</button>
        </form>
    </div>

    <!-- PAINEL ADMINISTRATIVO -->
    <div id="admin-dashboard" class="max-w-5xl mx-auto hidden">
        <div class="flex justify-between items-center mb-12 border-b border-white/10 pb-6">
            <div>
                <h1 class="text-2xl font-bold tracking-tighter">PAINEL DE <span class="text-neutral-500">CONTROLE</span></h1>
                <p class="text-xs text-neutral-500 uppercase tracking-widest mt-1">Bem-vindo, Fabio</p>
            </div>
            <div class="flex items-center gap-6">
                <a href="index.html" class="text-xs text-neutral-400 hover:text-white transition-colors">Visualizar Site</a>
                <button id="logout-btn" class="bg-red-900/20 text-red-500 px-4 py-2 rounded-lg text-xs font-bold hover:bg-red-900/40 transition-all">SAIR</button>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-12">
            <!-- SEﾃﾃグ DE Vﾃ好EOS -->
            <section class="bg-neutral-900 p-8 rounded-3xl border border-white/5 shadow-2xl">
                <h2 class="text-xl font-bold mb-6 italic flex items-center gap-2">
                    <span class="text-2xl">汐</span> Gerenciar Vﾃｭdeos
                </h2>
                <form id="video-form" class="space-y-4 mb-10">
                    <input type="text" id="video-title" placeholder="Tﾃｭtulo do Trabalho" class="input-dark" required>
                    <input type="url" id="video-url" placeholder="Link do YouTube" class="input-dark" required>
                    <button type="submit" class="w-full btn-primary">ADICIONAR Vﾃ好EO</button>
                </form>
                
                <h3 class="text-xs font-bold mb-4 text-neutral-500 uppercase tracking-widest border-b border-white/5 pb-2">Lista de Vﾃｭdeos</h3>
                <div id="admin-videos-list" class="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                    <!-- Dinﾃ｢mico -->
                </div>
            </section>

            <!-- SEﾃﾃグ DE FOTOS -->
            <section class="bg-neutral-900 p-8 rounded-3xl border border-white/5 shadow-2xl">
                <h2 class="text-xl font-bold mb-6 italic flex items-center gap-2">
                    <span class="text-2xl">萄</span> Galeria do Estﾃｺdio
                </h2>
                <div class="space-y-4 mb-10">
                    <div class="border-2 border-dashed border-white/10 rounded-2xl p-8 text-center hover:border-white/30 transition-all group">
                        <input type="file" id="photo-file" accept="image/*" class="hidden">
                        <label for="photo-file" class="cursor-pointer">
                            <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">刀</div>
                            <p class="text-sm text-neutral-400" id="file-name">Selecione uma foto</p>
                        </label>
                    </div>
                    <button id="upload-photo-btn" class="w-full btn-primary">ENVIAR FOTO</button>
                    <div id="upload-progress" class="hidden w-full bg-neutral-800 rounded-full h-1.5 mt-4 overflow-hidden">
                        <div id="progress-bar" class="bg-white h-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
                
                <h3 class="text-xs font-bold mb-4 text-neutral-500 uppercase tracking-widest border-b border-white/5 pb-2">Fotos na Galeria</h3>
                <div id="admin-photos-list" class="grid grid-cols-3 gap-3 max-h-[400px] overflow-y-auto pr-2">
                    <!-- Dinﾃ｢mico -->
                </div>
            </section>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        // CONFIGURAﾃﾃグ REAL DO FABIO BENEDETTI
        const firebaseConfig = {
          apiKey: "AIzaSyDhSp-QPDZI2AbNrYdZO447NKTF2PMYjlQ",
          authDomain: "humano-studio.firebaseapp.com",
          projectId: "humano-studio",
          storageBucket: "humano-studio.firebasestorage.app",
          messagingSenderId: "938534325822",
          appId: "1:938534325822:web:abf5443336ce3224190b6f",
          measurementId: "G-CT1NF7WLBJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // LOGIN
        const loginForm = document.getElementById('login-form');
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (err) { 
                alert('Erro: Credenciais invﾃ｡lidas ou usuﾃ｡rio nﾃ｣o cadastrado no Firebase Auth.'); 
            }
        });

        document.getElementById('logout-btn').onclick = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                loadContent();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('admin-dashboard').classList.add('hidden');
            }
        });

        // CARREGAR CONTEﾃ咼O
        function loadContent() {
            // Vﾃｭdeos
            onSnapshot(query(collection(db, "videos"), orderBy("timestamp", "desc")), (snap) => {
                const list = document.getElementById('admin-videos-list');
                list.innerHTML = '';
                snap.forEach(d => {
                    list.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/5 hover:border-white/10 transition-colors">
                            <div class="overflow-hidden pr-4">
                                <p class="text-sm font-bold truncate">${d.data().titulo}</p>
                                <p class="text-[10px] text-neutral-500 truncate italic">${d.data().url}</p>
                            </div>
                            <button onclick="deleteVideo('${d.id}')" class="text-red-500 text-[10px] font-bold uppercase tracking-widest hover:text-red-400">Apagar</button>
                        </div>`;
                });
            });

            // Fotos
            onSnapshot(query(collection(db, "fotos"), orderBy("timestamp", "desc")), (snap) => {
                const list = document.getElementById('admin-photos-list');
                list.innerHTML = '';
                snap.forEach(d => {
                    list.innerHTML += `
                        <div class="relative group aspect-square rounded-lg overflow-hidden border border-white/10">
                            <img src="${d.data().url}" class="w-full h-full object-cover">
                            <button onclick="deletePhoto('${d.id}', '${d.data().path}')" class="absolute inset-0 bg-red-600/90 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all text-[10px] font-bold uppercase">Remover</button>
                        </div>`;
                });
            });
        }

        // Aﾃﾃ髭S GLOBAIS
        window.deleteVideo = async (id) => { 
            if(confirm('Remover este vﾃｭdeo permanentemente?')) await deleteDoc(doc(db, "videos", id)); 
        };

        window.deletePhoto = async (id, path) => {
            if(confirm('Remover esta foto da galeria?')) {
                try {
                    await deleteDoc(doc(db, "fotos", id));
                    // Tentativa de apagar do Storage tambﾃｩm
                    try { await deleteObject(ref(storage, path)); } catch(e) { console.warn("Arquivo nﾃ｣o encontrado no Storage ou erro ao apagar."); }
                } catch (e) { alert('Erro ao excluir: ' + e.message); }
            }
        };

        // SALVAR Vﾃ好EO
        document.getElementById('video-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const title = document.getElementById('video-title').value;
            const url = document.getElementById('video-url').value;
            
            btn.disabled = true;
            btn.innerText = 'SALVANDO...';
            try {
                await addDoc(collection(db, "videos"), {
                    titulo: title,
                    url: url,
                    timestamp: serverTimestamp()
                });
                e.target.reset();
            } catch(e) { alert("Erro ao salvar: " + e.message); }
            finally { btn.disabled = false; btn.innerText = 'ADICIONAR Vﾃ好EO'; }
        };

        // UPLOAD DE FOTO
        const fileInput = document.getElementById('photo-file');
        fileInput.onchange = (e) => {
            const fileNameDisplay = document.getElementById('file-name');
            fileNameDisplay.innerText = e.target.files[0] ? e.target.files[0].name : 'Selecione uma foto';
            fileNameDisplay.classList.add('text-white');
        };

        document.getElementById('upload-photo-btn').onclick = async () => {
            const file = fileInput.files[0];
            if(!file) return alert('Selecione uma imagem primeiro');
            
            const btn = document.getElementById('upload-photo-btn');
            const progressContainer = document.getElementById('upload-progress');
            const progressBar = document.getElementById('progress-bar');
            
            const path = `galeria/${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
            const storageRef = ref(storage, path);
            const uploadTask = uploadBytesResumable(storageRef, file);
            
            btn.disabled = true;
            btn.innerText = 'ENVIANDO...';
            progressContainer.classList.remove('hidden');

            uploadTask.on('state_changed', 
                (snap) => {
                    const progress = (snap.bytesTransferred / snap.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                }, 
                (err) => { 
                    alert('Erro no upload: ' + err.message + '\nVerifique as regras do Firebase Storage!'); 
                    btn.disabled = false; 
                    btn.innerText = 'ENVIAR FOTO';
                }, 
                async () => {
                    const url = await getDownloadURL(uploadTask.snapshot.ref);
                    await addDoc(collection(db, "fotos"), { url, path, timestamp: serverTimestamp() });
                    btn.disabled = false;
                    btn.innerText = 'ENVIAR FOTO';
                    progressContainer.classList.add('hidden');
                    progressBar.style.width = '0%';
                    fileInput.value = '';
                    document.getElementById('file-name').innerText = 'Foto enviada com sucesso!';
                    setTimeout(() => document.getElementById('file-name').innerText = 'Selecione outra foto', 3000);
                }
            );
        };
    </script>
</body>
</html>
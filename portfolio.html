<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfólio | Fabio Benedetti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;0,900;1,900&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; }
        .nav-glass { background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .bg-layer { position: fixed; inset: 0; background-size: cover; background-position: center; filter: brightness(0.15); z-index: -1; }
        
        /* Card Vertical Styles */
        .work-card-vertical { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 2rem; 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 1.5rem; 
            overflow: hidden; 
            transition: all 0.4s ease;
            margin-bottom: 4rem;
        }
        @media (min-width: 768px) {
            .work-card-vertical { grid-template-columns: 1.2fr 1fr; gap: 3rem; }
            .work-card-vertical:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.05); }
        }

        .work-img-box { position: relative; aspect-ratio: 16/9; overflow: hidden; background: #111; }
        .work-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.7s ease; }
        .work-card-vertical:hover .work-img { transform: scale(1.05); }

        .work-info { padding: 2rem; display: flex; flex-direction: column; justify-content: center; }
        .btn-details { 
            display: inline-flex; 
            align-items: center; 
            gap: 10px; 
            margin-top: 2rem; 
            background: white; 
            color: black; 
            font-weight: 900; 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 0.2em; 
            padding: 16px 32px; 
            border-radius: 50px; 
            align-self: flex-start; 
            transition: transform 0.2s;
        }
        .btn-details:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div id="bg-layer" class="bg-layer"></div>
    
    <nav class="fixed top-0 w-full z-[100] h-20 nav-glass flex items-center px-6 md:px-12">
        <div class="max-w-7xl mx-auto w-full flex justify-between items-center">
            <a href="index.html" id="dyn-main-name" class="font-black italic text-xl tracking-tighter uppercase">FABIO BENEDETTI</a>
            <div class="hidden md:flex gap-10">
                <a href="index.html" class="text-[10px] font-bold uppercase tracking-widest text-neutral-500 hover:text-white transition-colors">Início</a>
                <a href="portfolio.html" class="text-[10px] font-bold uppercase tracking-widest text-white">Portfólio</a>
                <a href="galeria.html" class="text-[10px] font-bold uppercase tracking-widest text-neutral-500 hover:text-white transition-colors">Galeria</a>
                <a href="bio.html" class="text-[10px] font-bold uppercase tracking-widest text-neutral-500 hover:text-white transition-colors">Bio</a>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 pt-48 pb-20">
        <h1 class="text-6xl md:text-9xl font-black italic tracking-tighter mb-24 uppercase leading-none">Obras <br><span class="text-neutral-800 not-italic">Completas.</span></h1>
        
        <!-- Lista Vertical -->
        <div id="portfolio-list" class="flex flex-col">
            <div class="text-neutral-500 animate-pulse text-sm font-bold tracking-widest">CARREGANDO OBRAS DO BANCO DE DADOS...</div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyDhSp-QPDZI2AbNrYdZO447NKTF2PMYjlQ", authDomain: "humano-studio.firebaseapp.com", projectId: "humano-studio", storageBucket: "humano-studio.firebasestorage.app", messagingSenderId: "938534325822", appId: "1:938534325822:web:abf5443336ce3224190b6f" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Função segura para extrair ID do YouTube
        function getYouTubeId(url) {
            if (!url || typeof url !== 'string') return null;
            try {
                if (url.includes('v=')) return url.split('v=')[1].split('&')[0];
                if (url.includes('youtu.be/')) return url.split('youtu.be/')[1].split('?')[0];
                if (url.includes('/shorts/')) return url.split('/shorts/')[1].split('?')[0];
            } catch(e) { 
                console.warn("Erro ao processar URL:", url);
                return null; 
            }
            return null;
        }

        onSnapshot(doc(db, "site_content", "settings"), (snap) => {
            if(snap.exists()) {
                const d = snap.data();
                const nameEl = document.getElementById('dyn-main-name');
                if (nameEl && d.mainName) nameEl.innerText = d.mainName;
            }
        });

        onSnapshot(doc(db, "site_content", "backgrounds"), (snap) => {
            const url = snap.data()?.portfolio || snap.data()?.home;
            if(url) document.getElementById('bg-layer').style.backgroundImage = `url('${url}')`;
        });

        onSnapshot(collection(db, "trabalhos"), (snap) => {
            const container = document.getElementById('portfolio-list');
            if(!container) return;
            
            let works = [];
            snap.forEach(d => works.push({id: d.id, ...d.data()}));
            
            // LOG DE PROVA
            console.log(`[CEREBRO ADMIN] Total carregado do banco: ${works.length}`);
            
            // Ordenar por ordem definida no admin (decrescente: maior ordem primeiro)
            works.sort((a,b) => (b.ordem ?? 0) - (a.ordem ?? 0));

            container.innerHTML = ''; 
            
            let renderCount = 0;

            works.forEach(w => {
                // Definição da Capa (Blindada contra erros)
                let imageSrc = w.capaUrl;
                
                // Se não tem capa manual, tenta extrair do YouTube
                if (!imageSrc && w.videoUrl) {
                    const vId = getYouTubeId(w.videoUrl);
                    if(vId) {
                        imageSrc = `https://img.youtube.com/vi/${vId}/maxresdefault.jpg`;
                    }
                }
                
                // Fallback final se nada funcionar
                if (!imageSrc) imageSrc = w.fotoUrl || 'https://via.placeholder.com/800x450/000000/FFFFFF?text=SEM+MIDIA';

                const linkUrl = `obra.html?id=${w.id}`; 

                // HTML seguro com onerror para fallback de thumbnail
                container.innerHTML += `
                    <article class="work-card-vertical group cursor-pointer" onclick="window.location.href='${linkUrl}'">
                        <div class="work-img-box">
                            <img src="${imageSrc}" 
                                 class="work-img" 
                                 loading="lazy" 
                                 alt="${w.titulo || 'Obra'}"
                                 onerror="if(this.src.includes('maxresdefault')) { this.src = this.src.replace('maxresdefault','hqdefault'); } else { this.style.display='none'; }">
                        </div>
                        <div class="work-info">
                            <span class="text-[10px] font-bold text-blue-500 uppercase tracking-widest mb-2">${w.data || 'Produção'}</span>
                            <h2 class="text-3xl md:text-5xl font-black italic uppercase tracking-tighter leading-none mb-4">${w.titulo || 'Sem Título'}</h2>
                            <p class="text-neutral-400 text-sm line-clamp-3 mb-4 font-light">${w.descricao || 'Sem descrição.'}</p>
                            <span class="btn-details">
                                Ver Detalhes
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                            </span>
                        </div>
                    </article>
                `;
                renderCount++;
            });

            console.log(`[CEREBRO ADMIN] Total cards renderizados: ${renderCount}`);
            
            if(works.length !== renderCount) {
                console.warn("ALERTA: Divergência na renderização. Verifique os logs.");
            }
        });
    </script>
</body>
</html>